box: wercker/rvm@2.5.0
services:
  - wercker/postgresql
build:
  steps:
    - rvm-use:
      version: 2.2.0

        # A step that executes `bundle install` command
    - bundle-install:
      jobs: 4

        # A step that prepares the database.yml using the database in services
    - rails-database-yml:
      service: postgresql

        # A custom script step, name value is used in the UI
        # and the code value contains the command that get executed
    - script:
      name: echo ruby information
      code: |
        echo "ruby version $(ruby --version) running"
        echo "from location $(which ruby)"
      echo -p "gem list: $(gem list)"

      # Add more steps here:
    - script:
      name: rspec
      code: bundle exec rspec --color -f d
deploy:
  steps:
    - heroku-deploy
    - script:
      name: Update database
      code: heroku run rake db:migrate --app $APP_NAME
